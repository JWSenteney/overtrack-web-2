{% import 'game_summary.html' as game_summary with context %}
{% import 'map.html' as map with context %}

{% macro player(player, index) -%}
<div class="col-lg-4" style="{{ 'padding-right: 0.25rem; ' if index != 2 else '' }} {{ 'padding-left: 0.25rem; ' if index != 0 else '' }}">
    <div class="card bg-dark player-card" style="background-image: url('{{ image_url(player['champion'], True) }}')">
        <div class="card-header" style="background-color: {{ champion_colour(player['champion']) }}90; ">
            <h5>{{ player['name'] }}</h5>
        </div>
        <div class="card-body">
            {% if player['stats'] %}
            <table class="table table-borderless table-striped table-hover player-stats">
                <tbody>
                    <tr>
                        <th class="name">Kills</th>
                        <td class="value">{{ player['stats']['kills'] | ifnone('?') }}</td>
                    </tr>
                    <tr>
                        <th class="name">Damage Dealt</th>
                        <td class="value">{{ player['stats']['damage_dealt'] | ifnone('?') }}</td>
                    </tr>
                    <tr>
                        <th class="name">Survival Time</th>
                        <td class="value">{{ s2ts(player['stats']['survival_time'])}}</td>
                    </tr>
                    <tr>
                        <th class="name">Players Revived</th>
                        <td class="value">{{ player['stats']['players_revived'] | ifnone('?') }}</td>
                    </tr>
                    <tr>
                        <th class="name">Players Respawned</th>
                        <td class="value">{{ player['stats']['players_respawned'] | ifnone('?') }}</td>
                    </tr>
                </tbody>
            </table>
            {% endif %}
            {% if not player['stats'] %}
            <div style="height: 240px; margin-bottom: 16px;">
                <p>No endgame stats recorded</p>
                <p>Make sure you stay on the 'Squad Eliminated' / 'Champions of the Arena' screen for at least a second.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{%- endmacro %}


{% extends "base.html" %}
{% block title %}Game{% endblock %}
{% block meta %}
<meta content="{{ og_title }}" property="og:title">
<meta name="theme-color" content="{{ theme_colour }}">
<meta content="{{ og_description }}" property="og:description">
<meta content="{{ image_url(game['squad']['player']['champion']) }}" property='og:image'>
<link type="application/json+oembed" href="{{ url_for('static', filename='oembed.json') }}"/>
{% endblock %}
{% block content %}
    <h1 class="mx-0 mt-0 mb-lg-auto p-md-3 bg-header"><a href="/">Games</a></h1>
    <div class="container pt-3">
        <div class="container">
            <div class="row games-list-row">
                <table class="table table-borderless table-striped table-dark games-list">
                    <thead>
                        {{ game_summary.header() }}
                    </thead>
                    <tbody>
                        {{ game_summary.summary(summary, clickable=False) }}
                    </tbody>
                </table>
            </div>
            <div class="row weapons-map-row">
                <div class="col-sm-5 weapons-col">
                    <div class="card bg-dark">
                        <div class="card-header">
                            <h5>Weapons</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-borderless table-striped table-hover weapons-list">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Downs</th>
                                            <th>Time Carried</th>
                                            <th>Time Drawn</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for weapon in game['weapons']['weapon_stats'] %}
                                        <tr>
                                            <th class="weapon">{{ weapon['weapon'] }}</th>
                                            <td class="knockdowns">{{ weapon['knockdowns'] or 0 }}</td>
                                            <td class="time-held">{{ s2ts(weapon.get('time_held', 0)) }}</td>
                                            <td class="time-active">{{ s2ts(weapon.get('time_active', 0)) }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="card bg-dark">
                        <div class="card-header">
                            <h5>Combat</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-borderless combat-stats">
                                <thead>
                                    <tr>
                                        <th>Downs</th>
                                        <th>Elims</th>
                                        <th>Down Assists</th>
                                        <th>Elim Assists</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="value">{{ game['combat']['knockdowns'] | length }}</td>
                                        <td class="value">{{ game['combat']['eliminations'] | length }}</td>
                                        <td class="value">{{ game['combat']['knockdown_assists'] | length }}</td>
                                        <td class="value">{{ game['combat']['elimination_assists'] | length }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="col-sm-7 map-col">
                    <div class="card bg-dark">
                        <div class="card-header">
                            <h5>Route</h5>
                        </div>
                        <div class="card-body">
                            {{ map.map(game['route'], game['combat']) }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="row squad-row">
                {{ player(game['squad']['player'], 0) }}
                {{ player(game['squad']['squadmates'][0], 1) }}
                {{ player(game['squad']['squadmates'][1], 2) }}
            </div>

        </div>
    </div>
{% endblock %}
